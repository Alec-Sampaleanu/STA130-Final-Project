---
title: "Analyzing Hazard Data"
author: "Alec Sampaleanu"
date: "March 25, 2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = F, warning = F)
```

##Setup

```{r}
library(tidyverse)
```

```{r}
hazarddat <- read.csv("hazarddat.csv")

glimpse(hazarddat)
```

This is the hazardous driving dataset in its out-of-the-box form from GeoTab. The first thing to note is that this dataset has observations from outside of Canada. Since the focus of this project is on hazardous driving in Canada, we'll create a new data frame called hazardcan.

```{r}
hazardcan <- hazarddat %>%
  filter(Country == "Canada") %>%
  rename(Province = State)
```

This is a big data frame with over 10000 observations and 23 variables. Are all of these variables useful?

```{r}
remove <- c("County", "Rationale", "City", "Country", "ISO_3166_2")

hazardcan <- hazardcan %>%
  select(-one_of(remove))
```

County, City, and Rationale are all empty columns, and so are discarded. Country and the ISO designation are not needed either. At this point we have the data frame we'd like to proceed with.

##Number of Incidents

A very basic first step is to simply determine which province has the highest number of incidents within hazardous deiving zones.

```{r}
incidentprov <- hazardcan %>%
  group_by(Province) %>%
  summarise(TotalIncidents = sum(NumberIncidents))

incidentprov
```

This table shows that Ontario has the highest total number of hazardous driving incidents of any province in Canada. But what about incidents in respect to total population?

```{r}
populationprov <- read.csv("population.csv") %>%
  select(c(2,4)) %>%
  slice(c(2:11)) %>%
  rename(Province = Geographic.name) %>%
  rename(Population = Population..2016)

incidentprov <- incidentprov %>%
  inner_join(populationprov, by = "Province") %>%
  mutate(IncidentsPerCapita = TotalIncidents / Population)

plotprov <- incidentprov

plotprov$Province <- gsub(" ", "\n", plotprov$Province)

ggplot(plotprov, aes(reorder(Province, IncidentsPerCapita), IncidentsPerCapita)) +
  geom_bar(stat="identity") + labs(x = "Province") + 
  theme(axis.text.x = element_text(size = 8), )
```

Using population statistics taken from the 2016 Census, we can determine each provinces ratio of incidents per capita. In terms of incidents per capita, Manitoba is the most dangerous province, and PEI is the least dangerous. Is the number of incidents really the best way to determine danger, however? Incidents in this data set range from harsh braking to multi-vehicle incidents, so clearly there is a range of severity. That's where the Severity Score comes in.

##Severity Score

```{r}
plotcan <- hazardcan

plotcan$Province <- gsub(" ", "\n", plotcan$Province)

plotcan %>%
  ggplot(aes(Province, SeverityScore)) + geom_boxplot()
```

Not very useful, unfortunately, so lets focus in on the lower ranges.

```{r}
plotcan %>%
  ggplot(aes(reorder(Province, SeverityScore, median), SeverityScore)) + geom_boxplot() +
  coord_cartesian(ylim = c(0, 2))
```

It seems that Newfoundland has the highest median Severity Score for its hazardous driving areas, while Manitoba has the lowest. This is very interesting, because Manitoba was the province with the highest total number of incidents. 

```{r}
hazardcan %>%
  filter(Province == "Newfoundland and Labrador") %>%
  count()

hazardcan %>%
  filter(Province == "Prince Edward Island") %>%
  count()

hazardcan %>%
  filter(Province == "Saskatchewan") %>%
  count()
```

Of the three provinces with the highest median severity scores, none has more than 50 hazardous driving zones. In fact, PEI only has 2!

